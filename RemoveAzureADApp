# 登录准备删除AD App的Azure账号，该账号必须是global admin角色
Login-AzureRmAccount

# 获取账号下的所有AD App
$App = Get-AzureRmADApplication

# 打印所有的AD App并只展示几个关键参数
$App | ft DisplayName,IdentifierUris,ObjectId

# 修改deploymentid，该参数可在上面命令输出的IdentifierUris中获取，格式为https://*/<deploymentid>
$appsToRemove = $App | ?{$_.IdentifierUris -like "https://*/<deploymentid>"} 

# 查看该id下的所有App个数
$appsToRemove.Count

# 打印该id下的所有App信息
$appsToRemove | fl DisplayName,IdentifierUris,ObjectId 

# 删除该id下的所有App
foreach ($app in $appsToRemove)
{
   Set-AzureRmADApplication -ObjectId $app.ObjectId -AvailableToOtherTenants $false
   Remove-AzureRmADApplication -ObjectId $app.ObjectId -Force
}
